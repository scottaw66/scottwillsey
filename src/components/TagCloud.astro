---
import { getCollection } from "astro:content";
import { slugify } from "./utilities/StringFormat.js";

const allPosts = await getCollection("posts");
const allTags = allPosts.map((tag) => tag.data.keywords).flat();

const processedTags = allTags.reduce((acc, tag) => {
  const value = acc[tag] || 0;

  const pTags = {
    ...acc,
    [tag]: value + 1,
  };

  const sortedTags = Object.fromEntries(
    Object.entries(pTags).sort((a, b) => b[1] - a[1]),
  );

  return sortedTags;
}, {});

const { showCount, displayNumber } = Astro.props;
---

<span class="flex justify-center flex-wrap gap-[0.4rem]">
  {
    Object.entries(processedTags)
      .map(([key, val]) => (
        <a
          class="px-2 py-1 rounded border text-base uppercase no-underline [background-color:var(--tag-bg)] [color:var(--tag-text)] [border-color:var(--hyperlink)] hover:[background-color:var(--tag-bg-hover)] hover:[color:var(--tag-text-hover)]"
          href={`/tags/${slugify(key)}/`}
        >
          {key} {showCount && `(${val})`}
        </a>
      ))
      .slice(0, displayNumber)
  }
  {displayNumber < 999 ? <a class="px-2 py-1 rounded border text-base uppercase no-underline [background-color:var(--tag-bg)] [color:var(--tag-text)] [border-color:var(--hyperlink)] hover:[background-color:var(--tag-bg-hover)] hover:[color:var(--tag-text-hover)]" href="/tags/">All Tags ...</a> : null}
</span>
